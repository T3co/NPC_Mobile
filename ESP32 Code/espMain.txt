#include <Arduino.h>
#include <WiFi.h>
#include <FirebaseESP32.h>

#define FIREBASE_HOST "alteratutorial-default-rtdb.europe-west1.firebasedatabase.app"
#define FIREBASE_AUTH "9U5cGGnuLfcHWckDeVCA5hvMSf1Ki55yUNlVU6BQ"

#define WIFI_SSID ""
#define WIFI_PASSWORD ""

#define RXD2 16
#define TXD2 17
#define LED_TX 1
#define RX1 3

#define ledpin 2

FirebaseData fbdo;
int rx0;
int FromFB, FromAlt, Led_state;

bool a = false;
void blink();

void setup()
{
  Serial.begin(115200);
  Serial2.begin(9600, SERIAL_8N1, RXD2, TXD2);
 Serial1.begin(9600, SERIAL_8N1, RX1, LED_TX);


  pinMode(ledpin, OUTPUT);

  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  Serial.print("Connecting to Wi-Fi");

  while (WiFi.status() != WL_CONNECTED)
  {
    Serial.print(".");
    delay(300);
  }
  Serial.println("Connected with IP: ");
  Serial.print(WiFi.localIP());

  Firebase.begin(FIREBASE_HOST, FIREBASE_AUTH);
  Serial.println("Firebase Connected");
  Firebase.reconnectWiFi(true);
}

void loop()
{

  if (Firebase.getInt(fbdo, "messages/fromfb"))
  {
    FromFB = fbdo.intData();
  }
  delay(20);

  if (Firebase.getInt(fbdo, "messages/lights"))
  {
    Led_state = fbdo.intData();
  }
  delay(20);

  if (Serial2.available())
  {
    Serial2.write(FromFB);
  }
  delay(20);

   if (Serial1.available())
  {
    Serial1.write(Led_state);
  }
  delay(20);

  while (Serial2.available())
  {
    FromAlt = Serial2.read();
    delay(2);
    Firebase.setInt(fbdo, "messages/fromAltera", FromAlt);
  }
  blink();
  delay(50);
}

void blink()
{
  a = not a;
  if (a)
    digitalWrite(ledpin, HIGH);
  else
    digitalWrite(ledpin, LOW);
}